
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Memory Trainer - by Dineshkumar Rajendran</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --dark: #1f2937;
            --light: #f9fafb;
            --gray: #6b7280;
            --radius: 16px;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Animated Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(99, 102, 241, 0.2) 0%, transparent 50%);
            animation: backgroundMove 20s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes backgroundMove {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(-20px, -20px) scale(1.1); }
            66% { transform: translate(20px, -10px) scale(0.9); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 40px 20px;
            position: relative;
        }

        .header h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 800;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            letter-spacing: -0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .brain-icon {
            font-size: 1.2em;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .header p {
            font-size: 1.25rem;
            opacity: 0.95;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Navigation */
        .navigation {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 8px;
            box-shadow: var(--shadow-lg);
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-buttons {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: transparent;
            color: var(--dark);
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }

        .nav-btn:hover::before {
            opacity: 0.1;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

        /* Page System */
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        /* Glass Card Style */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
        }

        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 30px -5px rgba(0, 0, 0, 0.15);
        }

        /* Control Sections */
        .control-section {
            margin-bottom: 25px;
        }

        .control-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
        }

        .control-btn {
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            color: var(--dark);
            border: 2px solid transparent;
            padding: 14px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: var(--transition);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .control-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: var(--primary);
            opacity: 0.2;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }

        .control-btn:hover::after {
            width: 100%;
            height: 100%;
        }

        .control-btn:hover {
            background: linear-gradient(135deg, #e5e7eb, #d1d5db);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .control-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            transition: var(--transition);
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        /* Challenge Area */
        .challenge-area {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-radius: var(--radius);
            padding: 40px;
            margin-bottom: 30px;
            text-align: center;
            border: 2px solid #fbbf24;
            position: relative;
            overflow: hidden;
        }

        .challenge-area::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(251, 191, 36, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .challenge-display {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 800;
            color: var(--dark);
            margin: 30px 0;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: var(--radius);
            border: 3px dashed #fbbf24;
            position: relative;
            z-index: 1;
        }

        .answer-input {
            width: 100%;
            max-width: 500px;
            padding: 16px 24px;
            font-size: 1.25rem;
            text-align: center;
            border: 3px solid #fbbf24;
            border-radius: 12px;
            margin: 20px auto;
            display: block;
            transition: var(--transition);
            background: white;
            position: relative;
            z-index: 1;
        }

        .answer-input:focus {
            outline: none;
            border-color: var(--primary);
            transform: scale(1.02);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            margin-top: 25px;
            position: relative;
            z-index: 1;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn.primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn.success {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
        }

        .btn.danger {
            background: linear-gradient(135deg, var(--error), #dc2626);
            color: white;
        }

        .btn.warning {
            background: linear-gradient(135deg, var(--warning), #d97706);
            color: white;
        }

        /* Feedback */
        .feedback {
            margin: 20px auto;
            padding: 16px 24px;
            border-radius: 12px;
            font-weight: 600;
            text-align: center;
            max-width: 600px;
            opacity: 0;
            transform: translateY(20px);
            transition: var(--transition);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .feedback.show {
            opacity: 1;
            transform: translateY(0);
        }

        .feedback.correct {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            color: #065f46;
            border: 2px solid var(--success);
        }

        .feedback.incorrect {
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            color: #991b1b;
            border: 2px solid var(--error);
        }

        .feedback.info {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            color: #1e40af;
            border: 2px solid var(--info);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px;
            border-radius: var(--radius);
            text-align: center;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 15s linear infinite;
        }

        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 30px rgba(0,0,0,0.2);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            display: block;
            margin-bottom: 5px;
            position: relative;
            z-index: 1;
        }

        .stat-label {
            font-size: 0.95rem;
            opacity: 0.95;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        /* Reference Tables */
        .reference-grid {
            display: grid;
            gap: 30px;
            margin: 20px 0;
        }

        .reference-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .reference-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .number-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
        }

        .number-card {
            background: linear-gradient(135deg, #f9fafb, #f3f4f6);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e5e7eb;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .number-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 0;
        }

        .number-card:hover::after {
            opacity: 0.1;
        }

        .number-card:hover {
            border-color: var(--primary);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .number-card .number {
            font-weight: 800;
            color: var(--primary);
            font-size: 1.25rem;
            margin-bottom: 5px;
            position: relative;
            z-index: 1;
        }

        .number-card .word {
            color: var(--dark);
            font-size: 0.95rem;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        /* Table Styles */
        .reference-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .reference-table th,
        .reference-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        .reference-table th {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            font-weight: 700;
            font-size: 0.95rem;
        }

        .reference-table tr:hover {
            background: #f9fafb;
        }

        .reference-table .number-col {
            font-weight: 700;
            color: var(--primary);
            text-align: center;
        }

        /* Tab System for Reference */
        .tab-container {
            margin-bottom: 30px;
        }

        .tab-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab-btn {
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            color: var(--dark);
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            font-size: 0.95rem;
        }

        .tab-btn:hover {
            background: linear-gradient(135deg, #e5e7eb, #d1d5db);
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        /* Custom Practice Settings */
        .practice-settings {
            background: rgba(255, 255, 255, 0.9);
            border-radius: var(--radius);
            padding: 25px;
            margin: 20px 0;
            border: 2px solid #e5e7eb;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .settings-group {
            padding: 15px;
            background: #f9fafb;
            border-radius: 10px;
            border: 1px solid #e5e7eb;
        }

        .settings-title {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        /* External Links Section - Moved to bottom */
        .external-links {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            margin-top: 40px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }

        .link-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            text-decoration: none;
            padding: 12px 20px;
            border-radius: 10px;
            text-align: center;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .link-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.15);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .header p {
                font-size: 1rem;
            }

            .control-grid {
                grid-template-columns: 1fr;
            }

            .challenge-display {
                font-size: 2rem;
                min-height: 80px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .action-buttons {
                flex-direction: column;
                width: 100%;
            }

            .btn {
                width: 100%;
            }

            .links-grid {
                grid-template-columns: 1fr;
            }

            .glass-card {
                padding: 20px;
            }

            .number-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.75rem;
            }

            .challenge-display {
                font-size: 1.5rem;
                padding: 15px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .tab-buttons {
                flex-direction: column;
                width: 100%;
            }

            .tab-btn {
                width: 100%;
            }
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1><span class="brain-icon">🧠</span> Ultimate Memory Trainer</h1>
            <p>Master the Major System, Dominic System, PAO Method & More</p>
            
           
        </header>

        <nav class="navigation">
            <div class="nav-buttons">
                <button class="nav-btn active" data-page="practice">
                    <span>🎯</span> Practice
                </button>
                <button class="nav-btn" data-page="reference">
                    <span>📚</span> Reference
                </button>
                <button class="nav-btn" data-page="settings">
                    <span>⚙️</span> Settings
                </button>
            </div>

            <!-- Time History Section -->
            <div class="glass-card" style="margin-top: 20px;">
                <h3 class="control-title">⏱️ Response Time History</h3>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div style="text-align: center;">
                        <div style="font-size: 0.9rem; color: var(--gray);">Best Time</div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--success);" id="bestTime">-</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 0.9rem; color: var(--gray);">Worst Time</div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--error);" id="worstTime">-</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 0.9rem; color: var(--gray);">Median Time</div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);" id="medianTime">-</div>
                    </div>
                </div>
                
                <div style="background: #f9fafb; border-radius: 10px; padding: 15px; max-height: 300px; overflow-y: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 2px solid #e5e7eb;">
                                <th style="padding: 10px; text-align: left; color: var(--dark);">#</th>
                                <th style="padding: 10px; text-align: left; color: var(--dark);">Challenge</th>
                                <th style="padding: 10px; text-align: left; color: var(--dark);">Answer</th>
                                <th style="padding: 10px; text-align: center; color: var(--dark);">Result</th>
                                <th style="padding: 10px; text-align: right; color: var(--dark);">Time</th>
                                <th style="padding: 10px; text-align: center; color: var(--dark);">Speed</th>
                            </tr>
                        </thead>
                        <tbody id="timeHistoryBody">
                            <tr>
                                <td colspan="6" style="padding: 20px; text-align: center; color: var(--gray);">
                                    No attempts yet. Start practicing to see your time history!
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #e0e7ff, #c7d2fe); border-radius: 10px;">
                    <h4 style="margin-bottom: 10px; color: var(--dark);">🏆 Competition Benchmarks</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; font-size: 0.9rem;">
                        <div>⚡ <strong>World Class:</strong> &lt; 1.5s per item</div>
                        <div>🥇 <strong>Expert:</strong> 1.5 - 3s per item</div>
                        <div>🥈 <strong>Advanced:</strong> 3 - 5s per item</div>
                        <div>🥉 <strong>Intermediate:</strong> 5 - 10s per item</div>
                        <div>🎯 <strong>Beginner:</strong> 10 - 20s per item</div>
                        <div>📚 <strong>Learning:</strong> &gt; 20s per item</div>
                    </div>
                </div>
                
                <div style="margin-top: 15px; text-align: center;">
                    <button class="btn warning" onclick="exportTimeHistory()">📊 Export History</button>
                    <button class="btn danger" onclick="clearTimeHistory()">🗑️ Clear History</button>
                </div>
            </div>
        </nav>

        <!-- Practice Page -->
        <div id="practice" class="page active">
            <div class="glass-card">
                <!-- Training Mode Selection -->
                <div class="control-section">
                    <h2 class="control-title">🎮 Training Mode</h2>
                    <div class="control-grid">
                        <button class="control-btn active" data-mode="majorNumber">Major: Number → Word</button>
                        <button class="control-btn" data-mode="majorWord">Major: Word → Number</button>
                        <button class="control-btn" data-mode="dominic">Dominic System</button>
                        <button class="control-btn" data-mode="pao">PAO System</button>
                        <button class="control-btn" data-mode="pi">Pi Memorization</button>
                        <button class="control-btn" data-mode="binary">Binary Numbers</button>
                        <button class="control-btn" data-mode="cards">Deck of Cards</button>
                        <button class="control-btn" data-mode="mixed">Mixed Practice</button>
                    </div>
                </div>

                <!-- Customization Sections -->
                <div class="practice-settings" id="practiceSettings">
                    <!-- Major System Range Selector -->
                    <div id="majorSettings" class="settings-group">
                        <h3 class="settings-title">🔢 Major System Settings</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                            <div class="form-group">
                                <label class="form-label">Start Number</label>
                                <input type="number" id="majorRangeStart" class="form-input" min="0" max="99" value="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">End Number</label>
                                <input type="number" id="majorRangeEnd" class="form-input" min="0" max="99" value="99">
                            </div>
                        </div>
                        <div class="control-grid">
                            <button class="control-btn" onclick="setMajorRange(0, 9)">🟢 0-9</button>
                            <button class="control-btn" onclick="setMajorRange(0, 19)">🟡 0-19</button>
                            <button class="control-btn" onclick="setMajorRange(0, 29)">🟠 0-29</button>
                            <button class="control-btn" onclick="setMajorRange(0, 49)">🔴 0-49</button>
                            <button class="control-btn" onclick="setMajorRange(0, 99)">👑 0-99</button>
                        </div>
                        <div style="text-align: center; margin-top: 10px; color: var(--gray);">
                            Current Range: <strong id="majorCurrentRange" style="color: var(--primary);">0-99</strong>
                        </div>
                    </div>

                    <!-- Dominic System Settings -->
                    <div id="dominicSettings" class="settings-group" style="display: none;">
                        <h3 class="settings-title">👤 Dominic System Settings</h3>
                        <div class="form-group">
                            <label class="form-label">Practice Type</label>
                            <select id="dominicType" class="form-input">
                                <option value="numberToPerson">Number → Person</option>
                                <option value="personToNumber">Person → Number</option>
                                <option value="actionPractice">Actions Practice</option>
                                <option value="combined">Combined PA</option>
                            </select>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                            <div class="form-group">
                                <label class="form-label">Start Number</label>
                                <input type="number" id="dominicRangeStart" class="form-input" min="0" max="99" value="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">End Number</label>
                                <input type="number" id="dominicRangeEnd" class="form-input" min="0" max="99" value="99">
                            </div>
                        </div>
                        <div class="control-grid">
                            <button class="control-btn" onclick="setDominicRange(0, 9)">🟢 00-09</button>
                            <button class="control-btn" onclick="setDominicRange(0, 19)">🟡 00-19</button>
                            <button class="control-btn" onclick="setDominicRange(10, 19)">⚪ 10-19</button>
                            <button class="control-btn" onclick="setDominicRange(20, 29)">⚪ 20-29</button>
                            <button class="control-btn" onclick="setDominicRange(30, 39)">⚪ 30-39</button>
                            <button class="control-btn" onclick="setDominicRange(40, 49)">⚪ 40-49</button>
                            <button class="control-btn" onclick="setDominicRange(50, 59)">⚪ 50-59</button>
                            <button class="control-btn" onclick="setDominicRange(60, 69)">⚪ 60-69</button>
                            <button class="control-btn" onclick="setDominicRange(70, 79)">⚪ 70-79</button>
                            <button class="control-btn" onclick="setDominicRange(80, 89)">⚪ 80-89</button>
                            <button class="control-btn" onclick="setDominicRange(90, 99)">⚪ 90-99</button>
                            <button class="control-btn" onclick="setDominicRange(0, 49)">🟠 00-49</button>
                            <button class="control-btn" onclick="setDominicRange(50, 99)">🟠 50-99</button>
                            <button class="control-btn" onclick="setDominicRange(0, 99)">🔴 00-99</button>
                        </div>
                        <div style="text-align: center; margin-top: 10px; color: var(--gray);">
                            Current Range: <strong id="dominicCurrentRange" style="color: var(--primary);">0-99</strong>
                        </div>
                    </div>

                    <!-- PAO Settings -->
                    <div id="paoSettings" class="settings-group" style="display: none;">
                        <h3 class="settings-title">🎭 PAO System Settings</h3>
                        <div class="form-group">
                            <label class="form-label">Practice Type</label>
                            <select id="paoType" class="form-input">
                                <option value="full">Full PAO (6 digits)</option>
                                <option value="people">People Only</option>
                                <option value="actions">Actions Only</option>
                                <option value="objects">Objects Only</option>
                                <option value="story">Story Building</option>
                            </select>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                            <div class="form-group">
                                <label class="form-label">Start Number</label>
                                <input type="number" id="paoRangeStart" class="form-input" min="0" max="99" value="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">End Number</label>
                                <input type="number" id="paoRangeEnd" class="form-input" min="0" max="99" value="99">
                            </div>
                        </div>
                        <div class="control-grid">
                            <button class="control-btn" onclick="setPAORange(0, 9)">🟢 00-09</button>
                            <button class="control-btn" onclick="setPAORange(0, 19)">🟡 00-19</button>
                            <button class="control-btn" onclick="setPAORange(10, 19)">⚪ 10-19</button>
                            <button class="control-btn" onclick="setPAORange(20, 29)">⚪ 20-29</button>
                            <button class="control-btn" onclick="setPAORange(30, 39)">⚪ 30-39</button>
                            <button class="control-btn" onclick="setPAORange(40, 49)">⚪ 40-49</button>
                            <button class="control-btn" onclick="setPAORange(50, 59)">⚪ 50-59</button>
                            <button class="control-btn" onclick="setPAORange(60, 69)">⚪ 60-69</button>
                            <button class="control-btn" onclick="setPAORange(70, 79)">⚪ 70-79</button>
                            <button class="control-btn" onclick="setPAORange(80, 89)">⚪ 80-89</button>
                            <button class="control-btn" onclick="setPAORange(90, 99)">⚪ 90-99</button>
                            <button class="control-btn" onclick="setPAORange(0, 49)">🟠 00-49</button>
                            <button class="control-btn" onclick="setPAORange(50, 99)">🟠 50-99</button>
                            <button class="control-btn" onclick="setPAORange(0, 99)">🔴 00-99</button>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Digit Length</label>
                            <select id="paoDigits" class="form-input">
                                <option value="2">2 digits</option>
                                <option value="4">4 digits</option>
                                <option value="6">6 digits (Full PAO)</option>
                                <option value="8">8 digits</option>
                                <option value="10">10 digits</option>
                            </select>
                        </div>
                        <div style="text-align: center; margin-top: 10px; color: var(--gray);">
                            Current Range: <strong id="paoCurrentRange" style="color: var(--primary);">0-99</strong>
                        </div>
                    </div>

                    <!-- Pi Settings -->
                    <div id="piSettings" class="settings-group" style="display: none;">
                        <h3 class="settings-title">🥧 Pi Memorization Settings</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                            <div class="form-group">
                                <label class="form-label">Starting Position</label>
                                <input type="number" id="piStart" class="form-input" min="1" max="100000" value="1">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ending Position</label>
                                <input type="number" id="piEnd" class="form-input" min="1" max="100000" value="10">
                            </div>
                        </div>
                        <div class="control-grid">
                            <button class="control-btn" onclick="setPiRange(1, 10)">🟢 1-10</button>
                            <button class="control-btn" onclick="setPiRange(1, 20)">🟡 1-20</button>
                            <button class="control-btn" onclick="setPiRange(11, 20)">⚪ 11-20</button>
                            <button class="control-btn" onclick="setPiRange(21, 30)">⚪ 21-30</button>
                            <button class="control-btn" onclick="setPiRange(31, 40)">⚪ 31-40</button>
                            <button class="control-btn" onclick="setPiRange(41, 50)">⚪ 41-50</button>
                            <button class="control-btn" onclick="setPiRange(51, 60)">⚪ 51-60</button>
                            <button class="control-btn" onclick="setPiRange(61, 70)">⚪ 61-70</button>
                            <button class="control-btn" onclick="setPiRange(71, 80)">⚪ 71-80</button>
                            <button class="control-btn" onclick="setPiRange(81, 90)">⚪ 81-90</button>
                            <button class="control-btn" onclick="setPiRange(91, 100)">⚪ 91-100</button>
                            <button class="control-btn" onclick="setPiRange(1, 50)">🟠 1-50</button>
                            <button class="control-btn" onclick="setPiRange(1, 100)">🔴 1-100</button>
                            <button class="control-btn" onclick="setPiRange(1, 1000)">👑 1-1000</button>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Memory Format</label>
                            <select id="piFormat" class="form-input">
                                <option value="digits">Raw Digits</option>
                                <option value="major">Major System (2-digit chunks)</option>
                                <option value="dominic">Dominic System (4-digit chunks)</option>
                                <option value="pao">PAO System (6-digit chunks)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Answer Format</label>
                            <select id="piAnswerFormat" class="form-input">
                                <option value="sequence">Full Sequence</option>
                                <option value="chunks">Individual Chunks</option>
                                <option value="stories">Memory Stories</option>
                            </select>
                        </div>
                        <div style="text-align: center; margin-top: 10px; color: var(--gray);">
                            Current Range: <strong id="piCurrentRange" style="color: var(--primary);">1-10</strong>
                            (<span id="piDigitCount">10</span> digits)
                        </div>
                    </div>

                    <!-- Binary Settings -->
                    <div id="binarySettings" class="settings-group" style="display: none;">
                        <h3 class="settings-title">💻 Binary Numbers Settings</h3>
                        <div class="form-group">
                            <label class="form-label">Binary Length</label>
                            <select id="binaryLength" class="form-input">
                                <option value="4">4 bits</option>
                                <option value="8">8 bits (1 byte)</option>
                                <option value="16">16 bits</option>
                                <option value="32">32 bits</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Conversion Type</label>
                            <select id="binaryType" class="form-input">
                                <option value="toDecimal">Binary → Decimal</option>
                                <option value="toBinary">Decimal → Binary</option>
                                <option value="toMajor">Binary → Major System</option>
                            </select>
                        </div>
                    </div>

                    <!-- Cards Settings -->
                    <div id="cardsSettings" class="settings-group" style="display: none;">
                        <h3 class="settings-title">🃏 Playing Cards Settings</h3>
                        <div class="form-group">
                            <label class="form-label">Number of Cards</label>
                            <select id="cardsCount" class="form-input">
                                <option value="5">5 cards</option>
                                <option value="10">10 cards</option>
                                <option value="26">Half deck (26)</option>
                                <option value="52">Full deck (52)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Memory System</label>
                            <select id="cardsSystem" class="form-input">
                                <option value="major">Major System</option>
                                <option value="dominic">Dominic System</option>
                                <option value="pao">PAO System</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Challenge Area -->
            <div class="challenge-area">
                <div style="text-align: center; margin-bottom: 20px;">
                    <span id="liveTimer" style="font-size: 1.2rem; color: var(--primary); font-weight: bold; display: none;">
                        ⏱️ <span id="liveTimerValue">0.0</span>s
                    </span>
                </div>
                <div class="challenge-display" id="challengeDisplay">
                    Ready to train your memory? Click "New Challenge" to begin!
                </div>
                <input type="text" class="answer-input" id="answerInput" placeholder="Type your answer here..." disabled>
                <div class="action-buttons">
                    <button class="btn primary" onclick="newChallenge()">New Challenge</button>
                    <button class="btn success" id="submitBtn" onclick="checkAnswer()" disabled>Submit</button>
                    <button class="btn warning" id="hintBtn" onclick="showHint()" disabled>Hint</button>
                    <button class="btn danger" id="skipBtn" onclick="skipChallenge()" disabled>Skip</button>
                </div>
                <div class="feedback" id="feedback"></div>
            </div>

            <!-- Practice Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number" id="sessionTotal">0</span>
                    <span class="stat-label">Questions</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="sessionCorrect">0</span>
                    <span class="stat-label">Correct</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="sessionRate">0%</span>
                    <span class="stat-label">Success Rate</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="sessionStreak">0</span>
                    <span class="stat-label">Current Streak</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="averageTime">0s</span>
                    <span class="stat-label">Average Time</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="lastTime">0s</span>
                    <span class="stat-label">Last Answer</span>
                </div>
            </div>
        </div>

        <!-- Reference Page -->
        <div id="reference" class="page">
            <div class="glass-card">
                <h2 class="control-title">📚 Memory System References</h2>
                
                <div class="tab-container">
                    <div class="tab-buttons">
                        <button class="tab-btn active" data-tab="major">Major System</button>
                        <button class="tab-btn" data-tab="dominic">Dominic System</button>
                        <button class="tab-btn" data-tab="pao">PAO System</button>
                        <button class="tab-btn" data-tab="palace">Memory Palace</button>
                        <button class="tab-btn" data-tab="pi">Pi Numbers</button>
                        <button class="tab-btn" data-tab="cards">Card System</button>
                        <button class="tab-btn" data-tab="binary">Binary System</button>
                    </div>

                    <!-- Major System Tab -->
                    <div class="tab-content active" id="major-tab">
                        <div class="reference-card">
                            <h3 class="reference-title">🔤 Major System (00-99)</h3>
                            <p style="text-align: center; margin-bottom: 20px; color: var(--gray);">
                                Expert-verified phonetic number system used by memory champions
                            </p>
                            <div class="number-grid" id="majorGrid"></div>
                        </div>
                    </div>

                    <!-- Dominic System Tab -->
                    <div class="tab-content" id="dominic-tab">
                        <div class="reference-card">
                            <h3 class="reference-title">👤 Dominic System (00-99)</h3>
                            <p style="text-align: center; margin-bottom: 20px; color: var(--gray);">
                                Person-Action system created by Dominic O'Brien
                            </p>
                            <table class="reference-table" id="dominicTable">
                                <thead>
                                    <tr>
                                        <th>Number</th>
                                        <th>Letters</th>
                                        <th>Person</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="dominicBody"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- PAO System Tab -->
                    <div class="tab-content" id="pao-tab">
                        <div class="reference-card">
                            <h3 class="reference-title">🎭 PAO System</h3>
                            <p style="text-align: center; margin-bottom: 20px; color: var(--gray);">
                                Person-Action-Object system for advanced memory techniques
                            </p>
                            <div style="margin-bottom: 30px;">
                                <h4 style="margin-bottom: 15px;">👥 People (00-99)</h4>
                                <div class="number-grid" id="paoPeopleGrid"></div>
                            </div>
                            <div style="margin-bottom: 30px;">
                                <h4 style="margin-bottom: 15px;">⚡ Actions (00-99)</h4>
                                <div class="number-grid" id="paoActionsGrid"></div>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 15px;">🎯 Objects (00-99)</h4>
                                <div class="number-grid" id="paoObjectsGrid"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Pi Numbers Tab -->
                    <div class="tab-content" id="pi-tab">
                        <div class="reference-card">
                            <h3 class="reference-title">🥧 Pi Digits Reference</h3>
                            <p style="text-align: center; margin-bottom: 20px; color: var(--gray);">
                                First 100,000 digits of Pi for memorization practice
                            </p>
                            
                            <div style="margin-bottom: 30px;">
                                <h4 style="margin-bottom: 15px;">Quick Jump to Sections:</h4>
                                <div class="control-grid">
                                    <button class="control-btn" onclick="scrollToPiSection(0)">1-100</button>
                                    <button class="control-btn" onclick="scrollToPiSection(100)">101-200</button>
                                    <button class="control-btn" onclick="scrollToPiSection(200)">201-300</button>
                                    <button class="control-btn" onclick="scrollToPiSection(300)">301-400</button>
                                    <button class="control-btn" onclick="scrollToPiSection(400)">401-500</button>
                                    <button class="control-btn" onclick="scrollToPiSection(500)">501-1000</button>
                                    <button class="control-btn" onclick="scrollToPiSection(1000)">1001-5000</button>
                                    <button class="control-btn" onclick="scrollToPiSection(5000)">5001-10000</button>
                                    <button class="control-btn" onclick="scrollToPiSection(10000)">10001-50000</button>
                                    <button class="control-btn" onclick="scrollToPiSection(50000)">50001-100000</button>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 30px;">
                                <h4 style="margin-bottom: 15px;">🧠 Expert Memory Methods for Pi:</h4>
                                
                                <div class="hint-container">
                                    <div class="hint-title">🔤 Major System Method</div>
                                    <div class="hint-content">
                                        Convert 2-digit chunks to words using the Major System:<br>
                                        <strong>3.14159...</strong> → 31-41-59 → mat-rat-lip<br>
                                        Story: "A mat where a rat licks its lip"
                                    </div>
                                </div>
                                
                                <div class="hint-container">
                                    <div class="hint-title">👤 Dominic System Method</div>
                                    <div class="hint-content">
                                        Convert 4-digit chunks to Person-Action combinations:<br>
                                        <strong>3.1415...</strong> → 31-41 → Captain America (CA) + David Attenborough's action<br>
                                        Story: "Captain America is narrating nature documentaries"
                                    </div>
                                </div>
                                
                                <div class="hint-container">
                                    <div class="hint-title">🎭 PAO System Method</div>
                                    <div class="hint-content">
                                        Convert 6-digit chunks to Person-Action-Object stories:<br>
                                        <strong>3.141592...</strong> → 31-41-59 → Clint Eastwood + narrating + microphone<br>
                                        Story: "Clint Eastwood is narrating into a microphone"
                                    </div>
                                </div>
                                
                                <div class="hint-container">
                                    <div class="hint-title">🎵 Rhythm & Song Method</div>
                                    <div class="hint-content">
                                        Create rhythmic patterns or songs:<br>
                                        "3 point 1-4-1-5-9" (like a phone number rhythm)<br>
                                        Many memory champions use musical patterns for long sequences
                                    </div>
                                </div>
                                
                                <div class="hint-container">
                                    <div class="hint-title">🏛️ Memory Palace Journey</div>
                                    <div class="hint-content">
                                        Place PAO scenes in sequential palace locations:<br>
                                        Front door: Clint Eastwood scene (314159)<br>
                                        Living room: Next PAO scene (265358)<br>
                                        Continue through your palace for thousands of digits!
                                    </div>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <h4>📋 Customize Your Pi Practice:</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                                    <div class="form-group">
                                        <label class="form-label">Start Position</label>
                                        <input type="number" id="piRefStart" class="form-input" min="1" max="100000" value="1">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">End Position</label>
                                        <input type="number" id="piRefEnd" class="form-input" min="1" max="100000" value="100">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Display Format</label>
                                        <select id="piRefFormat" class="form-input">
                                            <option value="digits">Raw Digits</option>
                                            <option value="major">Major System</option>
                                            <option value="dominic">Dominic System</option>
                                            <option value="pao">PAO System</option>
                                        </select>
                                    </div>
                                    <div class="form-group" style="display: flex; align-items: flex-end;">
                                        <button class="btn primary" onclick="updatePiDisplay()">Update Display</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="piDigitsDisplay" style="font-family: monospace; font-size: 1.1rem; line-height: 2; background: #f9fafb; padding: 20px; border-radius: 10px; max-height: 500px; overflow-y: auto;">
                                <!-- Pi digits will be displayed here -->
                            </div>
                        </div>
                    </div>

                    <!-- Card System Tab -->
                    <div class="tab-content" id="cards-tab">
                        <div class="reference-card">
                            <h3 class="reference-title">🃏 Playing Cards Memory System</h3>
                            <p style="text-align: center; margin-bottom: 20px; color: var(--gray);">
                                Standard 52-card deck conversion systems
                            </p>
                            
                            <div style="margin-bottom: 30px;">
                                <h4 style="margin-bottom: 15px;">Card to Number Mapping:</h4>
                                <table class="reference-table">
                                    <thead>
                                        <tr>
                                            <th>Card</th>
                                            <th>Number</th>
                                            <th>Major System</th>
                                            <th>Dominic Person</th>
                                            <th>PAO Person</th>
                                        </tr>
                                    </thead>
                                    <tbody id="cardsTableBody">
                                        <!-- Card mappings will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div style="margin-bottom: 30px;">
                                <h4 style="margin-bottom: 15px;">Quick Reference Grid:</h4>
                                <div class="number-grid" id="cardsGrid">
                                    <!-- Cards grid will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Binary System Tab -->
                    <div class="tab-content" id="binary-tab">
                        <div class="reference-card">
                            <h3 class="reference-title">💻 Binary Number System</h3>
                            <p style="text-align: center; margin-bottom: 20px; color: var(--gray);">
                                Binary to decimal conversions and memory techniques
                            </p>
                            
                            <div style="margin-bottom: 30px;">
                                <h4 style="margin-bottom: 15px;">Binary Patterns (0-99):</h4>
                                <table class="reference-table">
                                    <thead>
                                        <tr>
                                            <th>Decimal</th>
                                            <th>Binary</th>
                                            <th>Major System</th>
                                            <th>Visual Pattern</th>
                                        </tr>
                                    </thead>
                                    <tbody id="binaryTableBody">
                                        <!-- Binary conversions will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div style="margin-bottom: 30px;">
                                <h4 style="margin-bottom: 15px;">Binary Chunking Method:</h4>
                                <div class="hint-container">
                                    <div class="hint-title">3-Bit Chunks (0-7)</div>
                                    <div class="hint-content">
                                        000=0, 001=1, 010=2, 011=3, 100=4, 101=5, 110=6, 111=7<br>
                                        Convert each 3-bit chunk to a single digit for easier memorization
                                    </div>
                                </div>
                                
                                <div class="hint-container">
                                    <div class="hint-title">4-Bit Chunks (0-15)</div>
                                    <div class="hint-content">
                                        0000=0, 0001=1, 0010=2, 0011=3, 0100=4, 0101=5, 0110=6, 0111=7<br>
                                        1000=8, 1001=9, 1010=A, 1011=B, 1100=C, 1101=D, 1110=E, 1111=F<br>
                                        Use hexadecimal for compact representation
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Memory Palace Tab -->
                    <div class="tab-content" id="palace-tab">
                        <div class="reference-card">
                            <h3 class="reference-title">🏛️ Memory Palace Guide</h3>
                            <div style="max-width: 800px; margin: 0 auto; line-height: 1.8;">
                                <p style="margin-bottom: 20px;">
                                    The Memory Palace (Method of Loci) is an ancient technique that uses familiar spatial environments to store and retrieve information.
                                </p>
                                
                                <h4 style="margin: 20px 0 10px;">🏗️ How to Build Your Palace:</h4>
                                <ol style="margin-left: 20px; margin-bottom: 20px;">
                                    <li><strong>Choose a familiar location</strong> - Your home, school, or workplace</li>
                                    <li><strong>Plan a specific route</strong> - Always follow the same path</li>
                                    <li><strong>Identify distinct locations</strong> - Doorways, furniture, windows</li>
                                    <li><strong>Place memorable images</strong> - Vivid, unusual, emotional</li>
                                    <li><strong>Review regularly</strong> - Mental walks strengthen memories</li>
                                </ol>

                                <h4 style="margin: 20px 0 10px;">💡 Example Locations:</h4>
                                <div class="control-grid" style="margin-top: 15px;">
                                    <div class="control-btn" style="cursor: default;">🚪 Front Door</div>
                                    <div class="control-btn" style="cursor: default;">🛋️ Living Room</div>
                                    <div class="control-btn" style="cursor: default;">🍳 Kitchen</div>
                                    <div class="control-btn" style="cursor: default;">🛏️ Bedroom</div>
                                    <div class="control-btn" style="cursor: default;">🚿 Bathroom</div>
                                    <div class="control-btn" style="cursor: default;">🪟 Window</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings" class="page">
            <div class="glass-card">
                <h2 class="control-title">⚙️ Settings</h2>
                <div style="max-width: 600px; margin: 0 auto;">
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="soundEnabled" checked> Enable Sound Effects
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="autoAdvance" checked> Auto-advance to next question
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Timer per question (seconds)</label>
                        <input type="number" class="form-input" id="timerSeconds" value="0" min="0" max="300">
                        <small style="color: var(--gray);">Set to 0 for no timer</small>
                    </div>
                    <div style="margin-top: 30px;">
                        <button class="btn danger" onclick="resetAllProgress()">Reset All Progress</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- External Links - Moved to Bottom -->
        <div class="external-links">
            <h3 style="text-align: center; margin-bottom: 15px; color: var(--dark);">🌐 Memory Training Resources</h3>
            <div class="links-grid">
                <a href="https://forum.artofmemory.com/" target="_blank" class="link-btn">
                    💬 Memory Forum
                </a>
                <a href="https://artofmemory.com/blog/list-of-memory-techniques/" target="_blank" class="link-btn">
                    📖 Memory Techniques
                </a>
                <a href="https://memoryleague.com/?utm_source=aom&utm_medium=body-text&utm_campaign=dedicated-page-cards-game#!/train" target="_blank" class="link-btn">
                    🎯 Memory League Training
                </a>
                <a href="https://artofmemory.com/worksheets/" target="_blank" class="link-btn">
                    📝 Training Worksheets
                </a>
                <a href="https://artofmemory.com/memory-league/" target="_blank" class="link-btn">
                    🏆 Memory Competition
                </a>
            </div>
        </div>
        
        <footer style="text-align: center; padding: 20px; color: white; background: rgba(0,0,0,0.2); margin-top: 40px; border-radius: var(--radius);">
            <p style="margin: 0;">
                🧠 <strong>Ultimate Memory Trainer</strong> • Version 6.0
            </p>
            <p style="margin: 5px 0; font-size: 0.9rem;">
                Created with ❤️ by <strong>Dineshkumar Rajendran</strong>
            </p>
            <p style="margin: 5px 0; font-size: 0.85rem; opacity: 0.8;">
                Idea, Design & Full Stack Development
            </p>
        </footer>
    </div>

    <script>
        // Updated Major System with standardized words
        const majorSystem = {
            '00': 'sauce', '01': 'seat', '02': 'sun', '03': 'sum', '04': 'sir',
            '05': 'sail', '06': 'sage', '07': 'sock', '08': 'safe', '09': 'soap',
            '10': 'toss', '11': 'tot', '12': 'tin', '13': 'tom', '14': 'tar',
            '15': 'tail', '16': 'tag', '17': 'tack', '18': 'taffy', '19': 'tap',
            '20': 'nose', '21': 'net', '22': 'nun', '23': 'name', '24': 'near',
            '25': 'nail', '26': 'notch', '27': 'neck', '28': 'knife', '29': 'knob',
            '30': 'moss', '31': 'mat', '32': 'man', '33': 'mom', '34': 'more',
            '35': 'mail', '36': 'match', '37': 'milk', '38': 'muff', '39': 'map',
            '40': 'rose', '41': 'rat', '42': 'rain', '43': 'ram', '44': 'rare',
            '45': 'rail', '46': 'rich', '47': 'rock', '48': 'roof', '49': 'rope',
            '50': 'lass', '51': 'lot', '52': 'lion', '53': 'lamb', '54': 'lore',
            '55': 'lily', '56': 'league', '57': 'lock', '58': 'leaf', '59': 'lip',
            '60': 'juice', '61': 'jet', '62': 'chain', '63': 'jam', '64': 'jar',
            '65': 'jell', '66': 'judge', '67': 'jack', '68': 'jeff', '69': 'ship',
            '70': 'case', '71': 'cat', '72': 'can', '73': 'cam', '74': 'car',
            '75': 'cola', '76': 'cage', '77': 'cake', '78': 'cafe', '79': 'cap',
            '80': 'fuse', '81': 'fat', '82': 'fan', '83': 'foam', '84': 'fire',
            '85': 'fail', '86': 'fish', '87': 'fog', '88': 'fife', '89': 'fob',
            '90': 'bus', '91': 'bat', '92': 'bun', '93': 'beam', '94': 'bear',
            '95': 'bail', '96': 'bag', '97': 'book', '98': 'beef', '99': 'baby'
        };

        // Updated Dominic System (aligned properly)
        const dominicSystem = {
            '00': { letters: 'OO', person: 'Ozzy Osbourne', action: 'biting bat' },
            '01': { letters: 'OA', person: 'Orlando Bloom', action: 'shooting arrows' },
            '02': { letters: 'OB', person: 'Obama', action: 'giving speech' },
            '03': { letters: 'OC', person: 'Oliver Cromwell', action: 'leading army' },
            '04': { letters: 'OD', person: 'Oscar De La Hoya', action: 'boxing' },
            '05': { letters: 'OE', person: 'Owen Wilson', action: 'saying wow' },
            '06': { letters: 'OS', person: 'Oscar (Sesame St)', action: 'in trash can' },
            '07': { letters: 'OG', person: 'Original Gangster', action: 'rapping' },
            '08': { letters: 'OH', person: 'Oliver Hardy', action: 'comedy routine' },
            '09': { letters: 'ON', person: 'Oliver North', action: 'saluting' },
            '10': { letters: 'AO', person: 'Annie Oakley', action: 'shooting' },
            '11': { letters: 'AA', person: 'Alan Alda', action: 'operating' },
            '12': { letters: 'AB', person: 'Abraham Lincoln', action: 'splitting logs' },
            '13': { letters: 'AC', person: 'Al Capone', action: 'counting money' },
            '14': { letters: 'AD', person: 'Anthony Davis', action: 'dunking' },
            '15': { letters: 'AE', person: 'Albert Einstein', action: 'writing equations' },
            '16': { letters: 'AS', person: 'Arnold Schwarzenegger', action: 'lifting weights' },
            '17': { letters: 'AG', person: 'Al Gore', action: 'presenting chart' },
            '18': { letters: 'AH', person: 'Adolf Hitler', action: 'marching' },
            '19': { letters: 'AN', person: 'Alfred Nobel', action: 'exploding dynamite' },
            '20': { letters: 'BO', person: 'Barack Obama', action: 'waving' },
            '21': { letters: 'BA', person: 'Ben Affleck', action: 'directing' },
            '22': { letters: 'BB', person: 'Bugs Bunny', action: 'eating carrot' },
            '23': { letters: 'BC', person: 'Bill Clinton', action: 'playing saxophone' },
            '24': { letters: 'BD', person: 'Bob Dylan', action: 'playing guitar' },
            '25': { letters: 'BE', person: 'Beethoven', action: 'conducting' },
            '26': { letters: 'BS', person: 'Britney Spears', action: 'dancing' },
            '27': { letters: 'BG', person: 'Bill Gates', action: 'typing' },
            '28': { letters: 'BH', person: 'Benny Hill', action: 'chasing' },
            '29': { letters: 'BN', person: 'Ben Nevis', action: 'climbing' },
            '30': { letters: 'CO', person: 'Conan O\'Brien', action: 'telling jokes' },
            '31': { letters: 'CA', person: 'Captain America', action: 'throwing shield' },
            '32': { letters: 'CB', person: 'Charlie Brown', action: 'kicking football' },
            '33': { letters: 'CC', person: 'Charlie Chaplin', action: 'walking funny' },
            '34': { letters: 'CD', person: 'Charles Darwin', action: 'observing' },
            '35': { letters: 'CE', person: 'Clint Eastwood', action: 'squinting' },
            '36': { letters: 'CS', person: 'Charles Schulz', action: 'drawing' },
            '37': { letters: 'CG', person: 'Che Guevara', action: 'smoking cigar' },
            '38': { letters: 'CH', person: 'Charlton Heston', action: 'parting sea' },
            '39': { letters: 'CN', person: 'Chuck Norris', action: 'roundhouse kick' },
            '40': { letters: 'DO', person: 'Don Quixote', action: 'jousting windmill' },
            '41': { letters: 'DA', person: 'David Attenborough', action: 'narrating' },
            '42': { letters: 'DB', person: 'David Beckham', action: 'kicking ball' },
            '43': { letters: 'DC', person: 'David Copperfield', action: 'magic trick' },
            '44': { letters: 'DD', person: 'Donald Duck', action: 'quacking' },
            '45': { letters: 'DE', person: 'Daniel Craig', action: 'shooting gun' },
            '46': { letters: 'DS', person: 'Dr. Seuss', action: 'rhyming' },
            '47': { letters: 'DG', person: 'Danny Glover', action: 'acting' },
            '48': { letters: 'DH', person: 'Dustin Hoffman', action: 'rain man counting' },
            '49': { letters: 'DN', person: 'David Niven', action: 'being suave' },
            '50': { letters: 'EO', person: 'Eeyore', action: 'being sad' },
            '51': { letters: 'EA', person: 'Edgar Allan Poe', action: 'writing gothic' },
            '52': { letters: 'EB', person: 'Elton John', action: 'playing piano' },
            '53': { letters: 'EC', person: 'Eric Clapton', action: 'playing guitar' },
            '54': { letters: 'ED', person: 'Ed Sheeran', action: 'singing' },
            '55': { letters: 'EE', person: 'E.T.', action: 'phoning home' },
            '56': { letters: 'ES', person: 'Elvis', action: 'swiveling hips' },
            '57': { letters: 'EG', person: 'Ellen DeGeneres', action: 'dancing' },
            '58': { letters: 'EH', person: 'Ernest Hemingway', action: 'writing' },
            '59': { letters: 'EN', person: 'Eminem', action: 'rapping' },
            '60': { letters: 'SO', person: 'Shaquille O\'Neal', action: 'dunking' },
            '61': { letters: 'SA', person: 'Samuel L Jackson', action: 'yelling' },
            '62': { letters: 'SB', person: 'Sandra Bullock', action: 'driving bus' },
            '63': { letters: 'SC', person: 'Santa Claus', action: 'delivering gifts' },
            '64': { letters: 'SD', person: 'Snoop Dogg', action: 'smoking' },
            '65': { letters: 'SE', person: 'Steven Spielberg', action: 'directing' },
            '66': { letters: 'SS', person: 'SpongeBob', action: 'flipping patties' },
            '67': { letters: 'SG', person: 'Selena Gomez', action: 'singing' },
            '68': { letters: 'SH', person: 'Sherlock Holmes', action: 'investigating' },
            '69': { letters: 'SN', person: 'Isaac Newton', action: 'apple falling' },
            '70': { letters: 'GO', person: 'Gordon Ramsay', action: 'yelling at chef' },
            '71': { letters: 'GA', person: 'Gandhi', action: 'peaceful protest' },
            '72': { letters: 'GB', person: 'George Bush', action: 'speaking' },
            '73': { letters: 'GC', person: 'George Clooney', action: 'being suave' },
            '74': { letters: 'GD', person: 'Grateful Dead', action: 'jamming' },
            '75': { letters: 'GE', person: 'George Foreman', action: 'grilling' },
            '76': { letters: 'GS', person: 'George Washington', action: 'crossing river' },
            '77': { letters: 'GG', person: 'Galileo', action: 'looking telescope' },
            '78': { letters: 'GH', person: 'George Harrison', action: 'playing guitar' },
            '79': { letters: 'GN', person: 'Gary Numan', action: 'being robotic' },
            '80': { letters: 'HO', person: 'Homer Simpson', action: 'eating donut' },
            '81': { letters: 'HA', person: 'Harry Potter', action: 'casting spell' },
            '82': { letters: 'HB', person: 'Humphrey Bogart', action: 'smoking' },
            '83': { letters: 'HC', person: 'Hillary Clinton', action: 'debating' },
            '84': { letters: 'HD', person: 'Harley Davidson', action: 'riding bike' },
            '85': { letters: 'HE', person: 'Hercules', action: 'lifting' },
            '86': { letters: 'HS', person: 'Han Solo', action: 'shooting first' },
            '87': { letters: 'HG', person: 'Hugh Grant', action: 'stammering' },
            '88': { letters: 'HH', person: 'Hulk Hogan', action: 'wrestling' },
            '89': { letters: 'HN', person: 'Harry Houdini', action: 'escaping' },
            '90': { letters: 'NO', person: 'Napoleon', action: 'conquering' },
            '91': { letters: 'NA', person: 'Neil Armstrong', action: 'moon walking' },
            '92': { letters: 'NB', person: 'Napoleon Bonaparte', action: 'commanding' },
            '93': { letters: 'NC', person: 'Nicolas Cage', action: 'overacting' },
            '94': { letters: 'ND', person: 'Neil Diamond', action: 'singing' },
            '95': { letters: 'NE', person: 'Nelson Mandela', action: 'inspiring' },
            '96': { letters: 'NS', person: 'Nicholas Sparks', action: 'writing romance' },
            '97': { letters: 'NG', person: 'Neil Gaiman', action: 'writing fantasy' },
            '98': { letters: 'NH', person: 'Neil Patrick Harris', action: 'magic tricks' },
            '99': { letters: 'NN', person: 'Marilyn Monroe', action: 'posing' }
        };

        // PAO System (aligned with Dominic for consistency)
        const paoSystem = {
            people: dominicSystem, // Use Dominic people for consistency
            actions: {
                '00': 'biting', '01': 'shooting', '02': 'speaking', '03': 'leading', '04': 'boxing',
                '05': 'saying', '06': 'hiding', '07': 'rapping', '08': 'performing', '09': 'saluting',
                '10': 'shooting', '11': 'operating', '12': 'splitting', '13': 'counting', '14': 'dunking',
                '15': 'calculating', '16': 'lifting', '17': 'presenting', '18': 'marching', '19': 'exploding',
                '20': 'waving', '21': 'directing', '22': 'eating', '23': 'playing', '24': 'strumming',
                '25': 'conducting', '26': 'dancing', '27': 'typing', '28': 'chasing', '29': 'climbing',
                '30': 'joking', '31': 'throwing', '32': 'kicking', '33': 'walking', '34': 'observing',
                '35': 'squinting', '36': 'drawing', '37': 'smoking', '38': 'parting', '39': 'kicking',
                '40': 'jousting', '41': 'narrating', '42': 'kicking', '43': 'performing', '44': 'quacking',
                '45': 'shooting', '46': 'rhyming', '47': 'acting', '48': 'counting', '49': 'charming',
                '50': 'moping', '51': 'writing', '52': 'playing', '53': 'strumming', '54': 'singing',
                '55': 'phoning', '56': 'swiveling', '57': 'dancing', '58': 'writing', '59': 'rapping',
                '60': 'dunking', '61': 'yelling', '62': 'driving', '63': 'delivering', '64': 'smoking',
                '65': 'directing', '66': 'flipping', '67': 'singing', '68': 'investigating', '69': 'discovering',
                '70': 'yelling', '71': 'protesting', '72': 'speaking', '73': 'charming', '74': 'jamming',
                '75': 'grilling', '76': 'crossing', '77': 'observing', '78': 'playing', '79': 'computing',
                '80': 'eating', '81': 'casting', '82': 'smoking', '83': 'debating', '84': 'riding',
                '85': 'lifting', '86': 'shooting', '87': 'stammering', '88': 'wrestling', '89': 'escaping',
                '90': 'conquering', '91': 'walking', '92': 'commanding', '93': 'overacting', '94': 'singing',
                '95': 'inspiring', '96': 'writing', '97': 'creating', '98': 'performing', '99': 'posing'
            },
            objects: {
                '00': 'bat', '01': 'arrow', '02': 'microphone', '03': 'sword', '04': 'gloves',
                '05': 'script', '06': 'trash can', '07': 'microphone', '08': 'bowler hat', '09': 'flag',
                '10': 'rifle', '11': 'scalpel', '12': 'axe', '13': 'money', '14': 'basketball',
                '15': 'equation', '16': 'weights', '17': 'chart', '18': 'boots', '19': 'dynamite',
                '20': 'flag', '21': 'camera', '22': 'carrot', '23': 'saxophone', '24': 'guitar',
                '25': 'baton', '26': 'dress', '27': 'computer', '28': 'cane', '29': 'mountain',
                '30': 'microphone', '31': 'shield', '32': 'football', '33': 'cane', '34': 'notebook',
                '35': 'revolver', '36': 'pencil', '37': 'cigar', '38': 'tablet', '39': 'board',
                '40': 'windmill', '41': 'camera', '42': 'soccer ball', '43': 'cards', '44': 'sailor hat',
                '45': 'gun', '46': 'book', '47': 'badge', '48': 'toothpick', '49': 'tuxedo',
                '50': 'tail', '51': 'raven', '52': 'piano', '53': 'guitar', '54': 'microphone',
                '55': 'phone', '56': 'jumpsuit', '57': 'microphone', '58': 'typewriter', '59': 'mic',
                '60': 'basketball', '61': 'briefcase', '62': 'bus', '63': 'sleigh', '64': 'joint',
                '65': 'camera', '66': 'spatula', '67': 'microphone', '68': 'magnifying glass', '69': 'apple',
                '70': 'apron', '71': 'glasses', '72': 'podium', '73': 'tuxedo', '74': 'guitar',
                '75': 'grill', '76': 'horse', '77': 'telescope', '78': 'guitar', '79': 'synthesizer',
                '80': 'donut', '81': 'wand', '82': 'cigarette', '83': 'pantsuit', '84': 'motorcycle',
                '85': 'boulder', '86': 'blaster', '87': 'flowers', '88': 'championship belt', '89': 'chains',
                '90': 'crown', '91': 'flag', '92': 'hat', '93': 'oscar', '94': 'microphone',
                '95': 'dove', '96': 'pen', '97': 'manuscript', '98': 'top hat', '99': 'dress'
            }
        };

        // Pi digits (first 100,000) - showing first 10,000 for reference, full 100k available in practice
        const piDigits = '31415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632788659361533818279682303019520353018529689957736225994138912497217752834791315155748572424541506959508295331168617278558890750983817546374649393192550604009277016711390098488240128583616035637076601047101819429555961989467678374494482553797747268471040475346462080466842590694912933136770289891521047521620569660240580381501935112533824300355876402474964732639141992726042699227967823547816360093417216412199245863150302861829745557067498385054945885869269956909272107975093029553211653449872027559602364806654991198818347977535663698074265425278625518184175746728909777727938000816470600161452491921732172147723501414419735685481613611573525521334757418494684385233239073941433345477624168625189835694855620992192221842725502542568876717904946016534668049886272327917860857843838279679766814541009538837863609506800642251252051173929848960841284886269456042419652850222106611863067442786220391949450471237137869609563643719172874677646575739624138908658326459958133904780275901' + 
            '99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999'; // Truncated for display, full 100k digits available in practice mode

        // Card system mappings
        const cardMappings = {
            suits: ['♠', '♥', '♦', '♣'],
            ranks: ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'],
            getCardNumber: function(rank, suit) {
                const rankValue = this.ranks.indexOf(rank);
                const suitValue = this.suits.indexOf(suit);
                return rankValue * 4 + suitValue;
            }
        };

        // Game State
        let gameState = {
            mode: 'majorNumber',
            currentChallenge: null,
            currentAnswer: null,
            challengeStartTime: null,
            liveTimerInterval: null,
            sessionStats: {
                total: 0,
                correct: 0,
                streak: 0,
                totalTime: 0,
                times: [],
                history: [] // Detailed history of all attempts
            },
            // Major System settings
            majorRange: { start: 0, end: 99 },
            // Dominic System settings
            dominicRange: { start: 0, end: 99 },
            dominicType: 'numberToPerson',
            // PAO settings
            paoRange: { start: 0, end: 99 },
            paoType: 'full',
            paoDigits: 6,
            // Pi settings
            piStart: 1,
            piEnd: 10,
            piFormat: 'digits',
            piAnswerFormat: 'sequence',
            // Binary settings
            binaryLength: 8,
            binaryType: 'toDecimal',
            // Cards settings
            cardsCount: 5,
            cardsSystem: 'major'
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            populateReferences();
            initializeEventListeners();
            updateSettingsVisibility();
            initializePiDisplay();
            initializeCardSystem();
            initializeBinarySystem();
        });

        // Event Listeners
        function initializeEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const page = this.getAttribute('data-page');
                    showPage(page);
                });
            });

            // Mode buttons
            document.querySelectorAll('[data-mode]').forEach(btn => {
                btn.addEventListener('click', function() {
                    setMode(this.getAttribute('data-mode'));
                });
            });

            // Tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tab = this.getAttribute('data-tab');
                    showTab(tab);
                });
            });

            // Range inputs
            document.getElementById('majorRangeStart').addEventListener('change', updateMajorRange);
            document.getElementById('majorRangeEnd').addEventListener('change', updateMajorRange);

            // Answer input - submit on Enter
            document.getElementById('answerInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !document.getElementById('submitBtn').disabled) {
                    checkAnswer();
                }
            });

            // Settings change listeners
            const settingsInputs = [
                'dominicType', 'dominicRangeStart', 'dominicRangeEnd', 
                'paoType', 'paoDigits', 'paoRangeStart', 'paoRangeEnd',
                'piStart', 'piEnd', 'piFormat', 'piAnswerFormat', 
                'binaryLength', 'binaryType', 'cardsCount', 'cardsSystem'
            ];
            
            settingsInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', function() {
                        updateGameSettings();
                    });
                }
            });
        }

        // Navigation
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');

            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-page="${pageId}"]`).classList.add('active');
        }

        // Tab System
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabId}-tab`).classList.add('active');

            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
        }

        // Mode Selection
        function setMode(mode) {
            gameState.mode = mode;
            document.querySelectorAll('[data-mode]').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
            updateSettingsVisibility();
        }

        // Update settings visibility based on mode
        function updateSettingsVisibility() {
            const settingsSections = {
                'majorNumber': 'majorSettings',
                'majorWord': 'majorSettings',
                'dominic': 'dominicSettings',
                'pao': 'paoSettings',
                'pi': 'piSettings',
                'binary': 'binarySettings',
                'cards': 'cardsSettings'
            };

            // Hide all settings
            document.querySelectorAll('.settings-group').forEach(group => {
                group.style.display = 'none';
            });

            // Show relevant settings
            const relevantSettings = settingsSections[gameState.mode];
            if (relevantSettings) {
                const element = document.getElementById(relevantSettings);
                if (element) {
                    element.style.display = 'block';
                }
            }
        }

        // Update game settings from form inputs
        function updateGameSettings() {
            // Dominic settings
            const dominicType = document.getElementById('dominicType');
            if (dominicType) gameState.dominicType = dominicType.value;

            // PAO settings
            const paoType = document.getElementById('paoType');
            if (paoType) gameState.paoType = paoType.value;
            
            const paoDigits = document.getElementById('paoDigits');
            if (paoDigits) gameState.paoDigits = parseInt(paoDigits.value);
            
            const paoRangeStart = document.getElementById('paoRangeStart');
            if (paoRangeStart) gameState.paoRange.start = parseInt(paoRangeStart.value) || 0;
            
            const paoRangeEnd = document.getElementById('paoRangeEnd');
            if (paoRangeEnd) gameState.paoRange.end = parseInt(paoRangeEnd.value) || 99;

            // Pi settings
            const piStart = document.getElementById('piStart');
            if (piStart) gameState.piStart = parseInt(piStart.value);
            
            const piEnd = document.getElementById('piEnd');
            if (piEnd) gameState.piEnd = parseInt(piEnd.value);
            
            const piFormat = document.getElementById('piFormat');
            if (piFormat) gameState.piFormat = piFormat.value;
            
            const piAnswerFormat = document.getElementById('piAnswerFormat');
            if (piAnswerFormat) gameState.piAnswerFormat = piAnswerFormat.value;

            // Update displays
            updateDominicRangeDisplay();
            updatePAORangeDisplay();
            updatePiRangeDisplay();

            // Binary settings
            const binaryLength = document.getElementById('binaryLength');
            if (binaryLength) gameState.binaryLength = parseInt(binaryLength.value);
            
            const binaryType = document.getElementById('binaryType');
            if (binaryType) gameState.binaryType = binaryType.value;

            // Cards settings
            const cardsCount = document.getElementById('cardsCount');
            if (cardsCount) gameState.cardsCount = parseInt(cardsCount.value);
            
            const cardsSystem = document.getElementById('cardsSystem');
            if (cardsSystem) gameState.cardsSystem = cardsSystem.value;
        }

        // Range Management
        function setMajorRange(start, end) {
            document.getElementById('majorRangeStart').value = start;
            document.getElementById('majorRangeEnd').value = end;
            updateMajorRange();
        }

        function updateMajorRange() {
            gameState.majorRange.start = parseInt(document.getElementById('majorRangeStart').value) || 0;
            gameState.majorRange.end = parseInt(document.getElementById('majorRangeEnd').value) || 99;

            // Validate range
            if (gameState.majorRange.start < 0) gameState.majorRange.start = 0;
            if (gameState.majorRange.end > 99) gameState.majorRange.end = 99;
            if (gameState.majorRange.end < gameState.majorRange.start) {
                gameState.majorRange.end = gameState.majorRange.start;
                document.getElementById('majorRangeEnd').value = gameState.majorRange.end;
            }

            // Update display
            document.getElementById('majorCurrentRange').textContent = `${gameState.majorRange.start}-${gameState.majorRange.end}`;
        }

        function setDominicRange(start, end) {
            gameState.dominicRange.start = start;
            gameState.dominicRange.end = end;
            document.getElementById('dominicRangeStart').value = start;
            document.getElementById('dominicRangeEnd').value = end;
            updateDominicRangeDisplay();
        }

        function updateDominicRangeDisplay() {
            const start = parseInt(document.getElementById('dominicRangeStart').value) || 0;
            const end = parseInt(document.getElementById('dominicRangeEnd').value) || 99;
            gameState.dominicRange.start = start;
            gameState.dominicRange.end = end;
            document.getElementById('dominicCurrentRange').textContent = `${start}-${end}`;
        }

        function setPAORange(start, end) {
            gameState.paoRange.start = start;
            gameState.paoRange.end = end;
            document.getElementById('paoRangeStart').value = start;
            document.getElementById('paoRangeEnd').value = end;
            updatePAORangeDisplay();
        }

        function updatePAORangeDisplay() {
            const start = parseInt(document.getElementById('paoRangeStart').value) || 0;
            const end = parseInt(document.getElementById('paoRangeEnd').value) || 99;
            gameState.paoRange.start = start;
            gameState.paoRange.end = end;
            document.getElementById('paoCurrentRange').textContent = `${start}-${end}`;
        }

        function setPiRange(start, end) {
            document.getElementById('piStart').value = start;
            document.getElementById('piEnd').value = end;
            updatePiRangeDisplay();
        }

        function updatePiRangeDisplay() {
            const start = parseInt(document.getElementById('piStart').value) || 1;
            const end = parseInt(document.getElementById('piEnd').value) || 10;
            gameState.piStart = start;
            gameState.piEnd = end;
            const digitCount = end - start + 1;
            document.getElementById('piCurrentRange').textContent = `${start}-${end}`;
            document.getElementById('piDigitCount').textContent = digitCount;
        }

        function initializePiDisplay() {
            const piDisplay = document.getElementById('piDigitsDisplay');
            if (piDisplay) {
                // Display first 100 digits by default
                updatePiDisplay();
            }
        }

        function updatePiDisplay() {
            const piDisplay = document.getElementById('piDigitsDisplay');
            if (!piDisplay) return;

            const start = (parseInt(document.getElementById('piRefStart')?.value) || 1) - 1;
            const end = parseInt(document.getElementById('piRefEnd')?.value) || 100;
            const format = document.getElementById('piRefFormat')?.value || 'digits';
            
            const digits = piDigits.substring(start, end);
            
            if (format === 'digits') {
                // Display raw digits with position markers
                let html = '<div style="display: grid; gap: 10px;">';
                for (let i = 0; i < digits.length; i += 100) {
                    const chunk = digits.substring(i, i + 100);
                    const position = start + i + 1;
                    html += `<div><strong style="color: var(--primary);">${position}-${Math.min(position + 99, start + digits.length)}:</strong><br>`;
                    
                    // Add spacing every 10 digits for readability
                    for (let j = 0; j < chunk.length; j += 10) {
                        html += chunk.substring(j, j + 10) + ' ';
                    }
                    html += '</div>';
                }
                html += '</div>';
                piDisplay.innerHTML = html;
            } else if (format === 'major') {
                // Convert to Major System
                let html = '<div style="display: grid; gap: 15px;">';
                for (let i = 0; i < digits.length; i += 50) {
                    const chunk = digits.substring(i, i + 50);
                    const position = start + i + 1;
                    html += `<div><strong style="color: var(--primary);">${position}-${Math.min(position + 49, start + digits.length)}:</strong><br>`;
                    html += '<div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">';
                    
                    for (let j = 0; j < chunk.length; j += 2) {
                        const twoDigits = chunk.substring(j, j + 2).padEnd(2, '0');
                        const word = majorSystem[twoDigits] || twoDigits;
                        html += `<span style="background: #e5e7eb; padding: 4px 8px; border-radius: 5px;">
                                   <strong>${twoDigits}</strong>: ${word}
                                 </span>`;
                    }
                    html += '</div></div>';
                }
                html += '</div>';
                piDisplay.innerHTML = html;
            } else if (format === 'dominic') {
                // Convert to Dominic System
                let html = '<div style="display: grid; gap: 15px;">';
                for (let i = 0; i < digits.length; i += 40) {
                    const chunk = digits.substring(i, i + 40);
                    const position = start + i + 1;
                    html += `<div><strong style="color: var(--primary);">${position}-${Math.min(position + 39, start + digits.length)}:</strong><br>`;
                    html += '<div style="display: grid; gap: 8px; margin-top: 10px;">';
                    
                    for (let j = 0; j < chunk.length; j += 4) {
                        const fourDigits = chunk.substring(j, j + 4);
                        if (fourDigits.length >= 4) {
                            const num1 = fourDigits.substring(0, 2);
                            const num2 = fourDigits.substring(2, 4);
                            const person1 = dominicSystem[num1]?.person || `Person ${num1}`;
                            const action2 = dominicSystem[num2]?.action || `Action ${num2}`;
                            html += `<div style="background: #f3f4f6; padding: 8px; border-radius: 5px;">
                                       <strong>${fourDigits}</strong>: ${person1} ${action2}
                                     </div>`;
                        }
                    }
                    html += '</div></div>';
                }
                html += '</div>';
                piDisplay.innerHTML = html;
            } else if (format === 'pao') {
                // Convert to PAO System
                let html = '<div style="display: grid; gap: 15px;">';
                for (let i = 0; i < digits.length; i += 30) {
                    const chunk = digits.substring(i, i + 30);
                    const position = start + i + 1;
                    html += `<div><strong style="color: var(--primary);">${position}-${Math.min(position + 29, start + digits.length)}:</strong><br>`;
                    html += '<div style="display: grid; gap: 10px; margin-top: 10px;">';
                    
                    for (let j = 0; j < chunk.length; j += 6) {
                        const sixDigits = chunk.substring(j, j + 6);
                        if (sixDigits.length >= 6) {
                            const p = sixDigits.substring(0, 2);
                            const a = sixDigits.substring(2, 4);
                            const o = sixDigits.substring(4, 6);
                            const person = paoSystem.people[p]?.person || `Person ${p}`;
                            const action = paoSystem.actions[a] || `Action ${a}`;
                            const object = paoSystem.objects[o] || `Object ${o}`;
                            html += `<div style="background: #fef3c7; padding: 10px; border-radius: 5px; border: 1px solid #fbbf24;">
                                       <strong>${sixDigits}</strong>: ${person} ${action} ${object}
                                     </div>`;
                        }
                    }
                    html += '</div></div>';
                }
                html += '</div>';
                piDisplay.innerHTML = html;
            }
        }

        function scrollToPiSection(position) {
            const piDisplay = document.getElementById('piDigitsDisplay');
            if (piDisplay) {
                const targetElement = piDisplay.querySelector(`div:nth-child(${Math.floor(position / 100) + 1})`);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }
        }

        function initializeCardSystem() {
            const cardsGrid = document.getElementById('cardsGrid');
            const cardsTableBody = document.getElementById('cardsTableBody');
            
            if (cardsGrid && cardsTableBody) {
                let tableHTML = '';
                let gridHTML = '';
                
                cardMappings.suits.forEach((suit, suitIndex) => {
                    cardMappings.ranks.forEach((rank, rankIndex) => {
                        const cardNumber = cardMappings.getCardNumber(rank, suit);
                        const paddedNumber = cardNumber.toString().padStart(2, '0');
                        const card = rank + suit;
                        
                        // Add to table
                        tableHTML += `
                            <tr>
                                <td style="font-size: 1.2rem; font-weight: bold;">${card}</td>
                                <td class="number-col">${paddedNumber}</td>
                                <td>${majorSystem[paddedNumber]}</td>
                                <td>${dominicSystem[paddedNumber].person}</td>
                                <td>${paoSystem.people[paddedNumber].person}</td>
                            </tr>
                        `;
                        
                        // Add to grid
                        gridHTML += `
                            <div class="number-card">
                                <div class="number" style="font-size: 1.5rem;">${card}</div>
                                <div class="word">${paddedNumber}: ${majorSystem[paddedNumber]}</div>
                            </div>
                        `;
                    });
                });
                
                cardsTableBody.innerHTML = tableHTML;
                cardsGrid.innerHTML = gridHTML;
            }
        }

        function initializeBinarySystem() {
            const binaryTableBody = document.getElementById('binaryTableBody');
            
            if (binaryTableBody) {
                let html = '';
                for (let i = 0; i < 100; i++) {
                    const binary = i.toString(2).padStart(7, '0');
                    const paddedDecimal = i.toString().padStart(2, '0');
                    const majorWord = majorSystem[paddedDecimal] || 'N/A';
                    
                    // Create visual pattern
                    let visualPattern = binary.split('').map(bit => 
                        bit === '1' ? '●' : '○'
                    ).join('');
                    
                    html += `
                        <tr>
                            <td class="number-col">${i}</td>
                            <td style="font-family: monospace; font-weight: bold;">${binary}</td>
                            <td>${majorWord}</td>
                            <td style="font-size: 1.2rem;">${visualPattern}</td>
                        </tr>
                    `;
                }
                
                binaryTableBody.innerHTML = html;
            }
        }

        // Challenge Generation
        function newChallenge() {
            let challenge, answer;

            // Clear any existing timer
            if (gameState.liveTimerInterval) {
                clearInterval(gameState.liveTimerInterval);
            }

            // Start timing
            gameState.challengeStartTime = Date.now();
            
            // Start live timer display
            document.getElementById('liveTimer').style.display = 'inline-block';
            updateLiveTimer();
            gameState.liveTimerInterval = setInterval(updateLiveTimer, 100); // Update every 100ms

            switch (gameState.mode) {
                case 'majorNumber':
                    const range = gameState.majorRange.end - gameState.majorRange.start + 1;
                    const randomNum = Math.floor(Math.random() * range) + gameState.majorRange.start;
                    challenge = randomNum.toString().padStart(2, '0');
                    answer = majorSystem[challenge];
                    break;

                case 'majorWord':
                    const numbers = Object.keys(majorSystem).filter(n => {
                        const num = parseInt(n);
                        return num >= gameState.majorRange.start && num <= gameState.majorRange.end;
                    });
                    const randomKey = numbers[Math.floor(Math.random() * numbers.length)];
                    challenge = majorSystem[randomKey];
                    answer = randomKey;
                    break;

                case 'dominic':
                    challenge = generateDominicChallenge();
                    answer = challenge.answer;
                    challenge = challenge.question;
                    break;

                case 'pao':
                    challenge = generatePAOChallenge();
                    answer = challenge.answer;
                    challenge = challenge.question;
                    break;

                case 'pi':
                    challenge = generatePiChallenge();
                    answer = challenge.answer;
                    challenge = challenge.question;
                    break;

                case 'binary':
                    challenge = generateBinaryChallenge();
                    answer = challenge.answer;
                    challenge = challenge.question;
                    break;

                case 'cards':
                    challenge = generateCardsChallenge();
                    answer = challenge.answer;
                    challenge = challenge.question;
                    break;

                case 'mixed':
                    // Randomly select a mode
                    const modes = ['majorNumber', 'majorWord', 'dominic', 'pao'];
                    gameState.mode = modes[Math.floor(Math.random() * modes.length)];
                    newChallenge();
                    return;

                default:
                    challenge = '00';
                    answer = 'sauce';
            }

            gameState.currentChallenge = challenge;
            gameState.currentAnswer = answer;
            document.getElementById('challengeDisplay').textContent = challenge;

            // Enable controls
            document.getElementById('answerInput').disabled = false;
            document.getElementById('answerInput').value = '';
            document.getElementById('answerInput').focus();
            document.getElementById('submitBtn').disabled = false;
            document.getElementById('hintBtn').disabled = false;
            document.getElementById('skipBtn').disabled = false;

            hideFeedback();
        }

        // Dominic Challenge Generation
        function generateDominicChallenge() {
            const range = gameState.dominicRange.end - gameState.dominicRange.start + 1;
            const randomNum = Math.floor(Math.random() * range) + gameState.dominicRange.start;
            const key = randomNum.toString().padStart(2, '0');
            const dominicData = dominicSystem[key];

            switch (gameState.dominicType) {
                case 'numberToPerson':
                    return {
                        question: key,
                        answer: dominicData.person
                    };
                case 'personToNumber':
                    return {
                        question: dominicData.person,
                        answer: key
                    };
                case 'actionPractice':
                    return {
                        question: `${dominicData.person} is...`,
                        answer: dominicData.action
                    };
                case 'combined':
                    // Generate 4-digit number for PA combination
                    const num1 = Math.floor(Math.random() * range) + gameState.dominicRange.start;
                    const num2 = Math.floor(Math.random() * range) + gameState.dominicRange.start;
                    const key1 = num1.toString().padStart(2, '0');
                    const key2 = num2.toString().padStart(2, '0');
                    const person1 = dominicSystem[key1];
                    const person2 = dominicSystem[key2];
                    return {
                        question: key1 + key2,
                        answer: `${person1.person} ${person2.action}`
                    };
            }
        }

        // PAO Challenge Generation
        function generatePAOChallenge() {
            const digits = gameState.paoDigits;
            let number = '';
            
            // Generate number based on range
            if (gameState.paoType !== 'full' && gameState.paoType !== 'story') {
                const range = gameState.paoRange.end - gameState.paoRange.start + 1;
                const randomNum = Math.floor(Math.random() * range) + gameState.paoRange.start;
                number = randomNum.toString().padStart(2, '0');
            } else {
                // For full PAO or story, generate appropriate length
                for (let i = 0; i < digits; i += 2) {
                    const range = gameState.paoRange.end - gameState.paoRange.start + 1;
                    const randomNum = Math.floor(Math.random() * range) + gameState.paoRange.start;
                    number += randomNum.toString().padStart(2, '0');
                }
            }

            switch (gameState.paoType) {
                case 'full':
                    const chunks = [];
                    for (let i = 0; i < number.length; i += 2) {
                        chunks.push(number.substr(i, 2));
                    }
                    
                    if (chunks.length >= 3) {
                        const person = paoSystem.people[chunks[0]].person;
                        const action = paoSystem.actions[chunks[1]];
                        const object = paoSystem.objects[chunks[2]];
                        return {
                            question: chunks.slice(0, 3).join(''),
                            answer: `${person} ${action} ${object}`
                        };
                    } else {
                        return {
                            question: number,
                            answer: 'Need at least 6 digits for full PAO'
                        };
                    }

                case 'people':
                    return {
                        question: number,
                        answer: paoSystem.people[number].person
                    };

                case 'actions':
                    return {
                        question: number,
                        answer: paoSystem.actions[number]
                    };

                case 'objects':
                    return {
                        question: number,
                        answer: paoSystem.objects[number]
                    };

                case 'story':
                    // Build a story from multiple PAO sequences
                    const story = [];
                    for (let i = 0; i < number.length - 5; i += 6) {
                        const p = number.substr(i, 2);
                        const a = number.substr(i + 2, 2);
                        const o = number.substr(i + 4, 2);
                        const person = paoSystem.people[p].person;
                        const action = paoSystem.actions[a];
                        const object = paoSystem.objects[o];
                        story.push(`${person} ${action} ${object}`);
                    }
                    return {
                        question: number,
                        answer: story.join('. ')
                    };
            }
        }

        // Pi Challenge Generation
        function generatePiChallenge() {
            const start = gameState.piStart - 1; // Convert to 0-indexed
            const end = gameState.piEnd - 1;
            const length = end - start + 1;
            const format = gameState.piFormat;
            const answerFormat = gameState.piAnswerFormat;
            
            const piSection = piDigits.substr(start, length);
            
            if (format === 'digits') {
                // Raw digits practice
                return {
                    question: `Pi digits ${gameState.piStart}-${gameState.piEnd}`,
                    answer: piSection
                };
            } else if (format === 'major') {
                // Major System practice
                const chunks = [];
                for (let i = 0; i < piSection.length; i += 2) {
                    const num = piSection.substr(i, 2).padEnd(2, '0');
                    chunks.push({
                        digits: num,
                        word: majorSystem[num] || num
                    });
                }
                
                if (answerFormat === 'sequence') {
                    return {
                        question: `Pi digits ${gameState.piStart}-${gameState.piEnd} (Major System)`,
                        answer: chunks.map(c => c.word).join(' ')
                    };
                } else if (answerFormat === 'chunks') {
                    // Practice individual chunks
                    const randomChunk = chunks[Math.floor(Math.random() * chunks.length)];
                    return {
                        question: `Major System: ${randomChunk.digits}`,
                        answer: randomChunk.word
                    };
                } else if (answerFormat === 'stories') {
                    return {
                        question: `Create story for Pi ${gameState.piStart}-${gameState.piEnd}`,
                        answer: chunks.map(c => `${c.digits}=${c.word}`).join(', ')
                    };
                }
            } else if (format === 'dominic') {
                // Dominic System practice
                const chunks = [];
                for (let i = 0; i < piSection.length; i += 4) {
                    const fourDigits = piSection.substr(i, 4);
                    if (fourDigits.length >= 4) {
                        const num1 = fourDigits.substr(0, 2);
                        const num2 = fourDigits.substr(2, 2);
                        chunks.push({
                            digits: fourDigits,
                            story: `${dominicSystem[num1].person} ${dominicSystem[num2].action}`
                        });
                    }
                }
                
                if (answerFormat === 'sequence') {
                    return {
                        question: `Pi digits ${gameState.piStart}-${gameState.piEnd} (Dominic PA)`,
                        answer: chunks.map(c => c.story).join('. ')
                    };
                } else if (answerFormat === 'chunks') {
                    const randomChunk = chunks[Math.floor(Math.random() * chunks.length)];
                    return {
                        question: `Dominic PA: ${randomChunk.digits}`,
                        answer: randomChunk.story
                    };
                } else if (answerFormat === 'stories') {
                    return {
                        question: `Create Dominic stories for Pi ${gameState.piStart}-${gameState.piEnd}`,
                        answer: chunks.map(c => `${c.digits}=${c.story}`).join('; ')
                    };
                }
            } else if (format === 'pao') {
                // PAO System practice
                const chunks = [];
                for (let i = 0; i < piSection.length; i += 6) {
                    const sixDigits = piSection.substr(i, 6);
                    if (sixDigits.length >= 6) {
                        const p = sixDigits.substr(0, 2);
                        const a = sixDigits.substr(2, 2);
                        const o = sixDigits.substr(4, 2);
                        const person = paoSystem.people[p].person;
                        const action = paoSystem.actions[a];
                        const object = paoSystem.objects[o];
                        chunks.push({
                            digits: sixDigits,
                            story: `${person} ${action} ${object}`
                        });
                    }
                }
                
                if (answerFormat === 'sequence') {
                    return {
                        question: `Pi digits ${gameState.piStart}-${gameState.piEnd} (PAO)`,
                        answer: chunks.map(c => c.story).join('. ')
                    };
                } else if (answerFormat === 'chunks') {
                    const randomChunk = chunks[Math.floor(Math.random() * chunks.length)];
                    return {
                        question: `PAO: ${randomChunk.digits}`,
                        answer: randomChunk.story
                    };
                } else if (answerFormat === 'stories') {
                    return {
                        question: `Create PAO stories for Pi ${gameState.piStart}-${gameState.piEnd}`,
                        answer: chunks.map(c => `${c.digits}=${c.story}`).join('; ')
                    };
                }
            }
            
            // Default fallback
            return {
                question: `Pi digits ${gameState.piStart}-${gameState.piEnd}`,
                answer: piSection
            };
        }

        // Binary Challenge Generation
        function generateBinaryChallenge() {
            const length = gameState.binaryLength;
            let binary = '';
            for (let i = 0; i < length; i++) {
                binary += Math.random() < 0.5 ? '0' : '1';
            }
            
            const decimal = parseInt(binary, 2);
            
            switch (gameState.binaryType) {
                case 'toDecimal':
                    return {
                        question: binary,
                        answer: decimal.toString()
                    };
                case 'toBinary':
                    return {
                        question: decimal.toString(),
                        answer: binary
                    };
                case 'toMajor':
                    const majorNum = decimal.toString().padStart(2, '0');
                    return {
                        question: binary,
                        answer: majorSystem[majorNum] || decimal.toString()
                    };
            }
        }

        // Cards Challenge Generation
        function generateCardsChallenge() {
            const suits = ['♠', '♥', '♦', '♣'];
            const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
            const cards = [];
            
            // Generate random cards
            for (let i = 0; i < gameState.cardsCount; i++) {
                const suit = suits[Math.floor(Math.random() * 4)];
                const rank = ranks[Math.floor(Math.random() * 13)];
                cards.push(rank + suit);
            }
            
            // Convert to memory system
            const cardToNumber = (card) => {
                const rank = card.slice(0, -1);
                const suit = card.slice(-1);
                const rankValue = {
                    'A': '1', '2': '2', '3': '3', '4': '4', '5': '5',
                    '6': '6', '7': '7', '8': '8', '9': '9', '10': '10',
                    'J': '11', 'Q': '12', 'K': '13'
                }[rank];
                const suitValue = {
                    '♠': '0', '♥': '1', '♦': '2', '♣': '3'
                }[suit];
                return (parseInt(rankValue) - 1) * 4 + parseInt(suitValue);
            };
            
            const conversions = cards.map(card => {
                const num = cardToNumber(card).toString().padStart(2, '0');
                
                switch (gameState.cardsSystem) {
                    case 'major':
                        return majorSystem[num];
                    case 'dominic':
                        return dominicSystem[num].person;
                    case 'pao':
                        return paoSystem.people[num].person;
                    default:
                        return num;
                }
            });
            
            return {
                question: cards.join(' '),
                answer: conversions.join(' ')
            };
        }

        // Answer Checking
        function checkAnswer() {
            const userAnswer = document.getElementById('answerInput').value.trim().toLowerCase();
            const correctAnswer = gameState.currentAnswer.toLowerCase();

            // Stop live timer
            if (gameState.liveTimerInterval) {
                clearInterval(gameState.liveTimerInterval);
                gameState.liveTimerInterval = null;
            }

            // Calculate time taken
            const timeTaken = (Date.now() - gameState.challengeStartTime) / 1000; // in seconds
            gameState.sessionStats.times.push(timeTaken);
            gameState.sessionStats.totalTime += timeTaken;

            gameState.sessionStats.total++;

            const isCorrect = userAnswer === correctAnswer;
            
            // Record detailed history
            const historyEntry = {
                number: gameState.sessionStats.total,
                challenge: gameState.currentChallenge,
                userAnswer: userAnswer,
                correctAnswer: gameState.currentAnswer,
                isCorrect: isCorrect,
                time: timeTaken,
                mode: gameState.mode,
                timestamp: new Date().toISOString()
            };
            gameState.sessionStats.history.push(historyEntry);

            if (isCorrect) {
                gameState.sessionStats.correct++;
                gameState.sessionStats.streak++;
                showFeedback(`✅ Correct! Well done! (Time: ${timeTaken.toFixed(1)}s)`, 'correct');
            } else {
                gameState.sessionStats.streak = 0;
                showFeedback(`❌ Incorrect. The answer is: ${gameState.currentAnswer} (Time: ${timeTaken.toFixed(1)}s)`, 'incorrect');
            }

            // Disable controls
            document.getElementById('answerInput').disabled = true;
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('hintBtn').disabled = true;
            document.getElementById('skipBtn').disabled = true;

            updateStats();
            updateTimeHistory();

            // Auto-advance if enabled
            if (document.getElementById('autoAdvance').checked) {
                setTimeout(newChallenge, 2000);
            }
        }

        // Skip Challenge
        function skipChallenge() {
            // Stop live timer
            if (gameState.liveTimerInterval) {
                clearInterval(gameState.liveTimerInterval);
                gameState.liveTimerInterval = null;
            }

            // Calculate time taken
            const timeTaken = (Date.now() - gameState.challengeStartTime) / 1000; // in seconds
            gameState.sessionStats.times.push(timeTaken);
            gameState.sessionStats.totalTime += timeTaken;

            gameState.sessionStats.total++;
            gameState.sessionStats.streak = 0;
            
            // Record detailed history
            const historyEntry = {
                number: gameState.sessionStats.total,
                challenge: gameState.currentChallenge,
                userAnswer: 'SKIPPED',
                correctAnswer: gameState.currentAnswer,
                isCorrect: false,
                time: timeTaken,
                mode: gameState.mode,
                timestamp: new Date().toISOString()
            };
            gameState.sessionStats.history.push(historyEntry);
            
            showFeedback(`Skipped. The answer was: ${gameState.currentAnswer} (Time: ${timeTaken.toFixed(1)}s)`, 'info');
            
            updateStats();
            updateTimeHistory();
            
            if (document.getElementById('autoAdvance').checked) {
                setTimeout(newChallenge, 2000);
            }
        }

        // Show Hint
        function showHint() {
            let hint = '';
            
            switch (gameState.mode) {
                case 'majorNumber':
                case 'majorWord':
                    hint = gameState.currentAnswer.substring(0, Math.ceil(gameState.currentAnswer.length / 2)) + '...';
                    break;
                case 'dominic':
                    if (gameState.dominicType === 'numberToPerson') {
                        hint = `Person starts with: ${gameState.currentAnswer.substring(0, 3)}...`;
                    } else if (gameState.dominicType === 'personToNumber') {
                        hint = `Number starts with: ${gameState.currentAnswer.substring(0, 1)}...`;
                    } else {
                        hint = `Action: ${gameState.currentAnswer.substring(0, Math.ceil(gameState.currentAnswer.length / 2))}...`;
                    }
                    break;
                case 'pao':
                    if (gameState.paoType === 'full') {
                        hint = 'Think: Person-Action-Object';
                    } else {
                        hint = gameState.currentAnswer.substring(0, Math.ceil(gameState.currentAnswer.length / 2)) + '...';
                    }
                    break;
                case 'pi':
                    hint = `First word: ${gameState.currentAnswer.split(' ')[0]}`;
                    break;
                case 'binary':
                    hint = `First half: ${gameState.currentAnswer.substring(0, Math.ceil(gameState.currentAnswer.length / 2))}`;
                    break;
                case 'cards':
                    hint = `First card: ${gameState.currentAnswer.split(' ')[0]}`;
                    break;
                default:
                    hint = gameState.currentAnswer.substring(0, Math.ceil(gameState.currentAnswer.length / 2)) + '...';
            }
            
            showFeedback(`Hint: ${hint}`, 'info');
        }

        // Feedback Display
        function showFeedback(message, type) {
            const feedback = document.getElementById('feedback');
            
            // Add timing performance indicator
            if (gameState.sessionStats.times.length > 0) {
                const lastTime = gameState.sessionStats.times[gameState.sessionStats.times.length - 1];
                let timeIndicator = '';
                
                if (lastTime < 3) {
                    timeIndicator = ' ⚡ Lightning fast!';
                } else if (lastTime < 5) {
                    timeIndicator = ' 🚀 Great speed!';
                } else if (lastTime < 10) {
                    timeIndicator = ' ✓ Good timing';
                } else if (lastTime < 15) {
                    timeIndicator = ' 🐢 Try to be faster';
                } else {
                    timeIndicator = ' ⏰ Speed up your recall';
                }
                
                message += timeIndicator;
            }
            
            feedback.innerHTML = message;
            feedback.className = `feedback ${type} show`;
        }

        function hideFeedback() {
            const feedback = document.getElementById('feedback');
            feedback.classList.remove('show');
        }

        // Stats Management
        function updateStats() {
            document.getElementById('sessionTotal').textContent = gameState.sessionStats.total;
            document.getElementById('sessionCorrect').textContent = gameState.sessionStats.correct;
            document.getElementById('sessionStreak').textContent = gameState.sessionStats.streak;
            
            const rate = gameState.sessionStats.total > 0 
                ? Math.round((gameState.sessionStats.correct / gameState.sessionStats.total) * 100) 
                : 0;
            document.getElementById('sessionRate').textContent = rate + '%';
            
            // Update timing stats
            if (gameState.sessionStats.times.length > 0) {
                const lastTime = gameState.sessionStats.times[gameState.sessionStats.times.length - 1];
                document.getElementById('lastTime').textContent = lastTime.toFixed(1) + 's';
                
                const avgTime = gameState.sessionStats.totalTime / gameState.sessionStats.times.length;
                document.getElementById('averageTime').textContent = avgTime.toFixed(1) + 's';
            } else {
                document.getElementById('lastTime').textContent = '0s';
                document.getElementById('averageTime').textContent = '0s';
            }
        }

        // Reference Population
        function populateReferences() {
            // Major System
            const majorGrid = document.getElementById('majorGrid');
            for (let i = 0; i < 100; i++) {
                const num = i.toString().padStart(2, '0');
                const card = document.createElement('div');
                card.className = 'number-card';
                card.innerHTML = `
                    <div class="number">${num}</div>
                    <div class="word">${majorSystem[num]}</div>
                `;
                majorGrid.appendChild(card);
            }

            // Dominic System
            const dominicBody = document.getElementById('dominicBody');
            for (let i = 0; i < 100; i++) {
                const num = i.toString().padStart(2, '0');
                const system = dominicSystem[num];
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="number-col">${num}</td>
                    <td>${system.letters}</td>
                    <td>${system.person}</td>
                    <td>${system.action}</td>
                `;
                dominicBody.appendChild(row);
            }

            // PAO System
            populatePAOGrid('paoPeopleGrid', paoSystem.people, 'person');
            populatePAOGrid('paoActionsGrid', paoSystem.actions);
            populatePAOGrid('paoObjectsGrid', paoSystem.objects);
        }

        function populatePAOGrid(gridId, data, type) {
            const grid = document.getElementById(gridId);
            for (let i = 0; i < 100; i++) {
                const num = i.toString().padStart(2, '0');
                const card = document.createElement('div');
                card.className = 'number-card';
                
                let displayText;
                if (type === 'person' && data[num]) {
                    displayText = data[num].person;
                } else {
                    displayText = data[num] || 'N/A';
                }
                
                card.innerHTML = `
                    <div class="number">${num}</div>
                    <div class="word">${displayText}</div>
                `;
                grid.appendChild(card);
            }
        }

        // Settings
        function resetAllProgress() {
            if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
                gameState.sessionStats = {
                    total: 0,
                    correct: 0,
                    streak: 0,
                    totalTime: 0,
                    times: [],
                    history: []
                };
                updateStats();
                updateTimeHistory();
                showFeedback('Progress reset successfully', 'info');
            }
        }

        // Timer Functions
        function updateLiveTimer() {
            if (gameState.challengeStartTime) {
                const elapsed = (Date.now() - gameState.challengeStartTime) / 1000;
                const timerValue = document.getElementById('liveTimerValue');
                if (timerValue) {
                    timerValue.textContent = elapsed.toFixed(1);
                    
                    // Change color based on time
                    const timerElement = document.getElementById('liveTimer');
                    if (elapsed < 3) {
                        timerElement.style.color = '#10b981'; // Green
                    } else if (elapsed < 10) {
                        timerElement.style.color = '#f59e0b'; // Orange
                    } else {
                        timerElement.style.color = '#ef4444'; // Red
                    }
                }
            }
        }

        // Time History Functions
        function updateTimeHistory() {
            const tbody = document.getElementById('timeHistoryBody');
            const history = gameState.sessionStats.history;
            
            if (!tbody || history.length === 0) return;
            
            // Build table rows
            let html = '';
            for (let i = history.length - 1; i >= 0; i--) { // Show newest first
                const entry = history[i];
                const speedClass = getSpeedClass(entry.time);
                const resultIcon = entry.isCorrect ? '✅' : (entry.userAnswer === 'SKIPPED' ? '⏭️' : '❌');
                
                html += `
                    <tr style="border-bottom: 1px solid #e5e7eb;">
                        <td style="padding: 10px; color: var(--gray);">${entry.number}</td>
                        <td style="padding: 10px; font-weight: 600;">${truncateText(entry.challenge, 20)}</td>
                        <td style="padding: 10px;">${truncateText(entry.userAnswer, 20)}</td>
                        <td style="padding: 10px; text-align: center;">${resultIcon}</td>
                        <td style="padding: 10px; text-align: right; font-weight: 600; color: ${getTimeColor(entry.time)}">
                            ${entry.time.toFixed(1)}s
                        </td>
                        <td style="padding: 10px; text-align: center;">
                            <span style="padding: 4px 8px; border-radius: 12px; font-size: 0.8rem; background: ${speedClass.bg}; color: ${speedClass.color};">
                                ${speedClass.label}
                            </span>
                        </td>
                    </tr>
                `;
            }
            
            tbody.innerHTML = html;
            
            // Update statistics
            updateTimeStatistics();
        }

        function updateTimeStatistics() {
            const times = gameState.sessionStats.times;
            
            if (times.length === 0) {
                document.getElementById('bestTime').textContent = '-';
                document.getElementById('worstTime').textContent = '-';
                document.getElementById('medianTime').textContent = '-';
                return;
            }
            
            const sortedTimes = [...times].sort((a, b) => a - b);
            const best = Math.min(...times);
            const worst = Math.max(...times);
            const median = sortedTimes[Math.floor(sortedTimes.length / 2)];
            
            document.getElementById('bestTime').textContent = best.toFixed(1) + 's';
            document.getElementById('worstTime').textContent = worst.toFixed(1) + 's';
            document.getElementById('medianTime').textContent = median.toFixed(1) + 's';
        }

        function getSpeedClass(time) {
            if (time < 1.5) return { label: 'World Class', bg: '#ffd700', color: '#744210' };
            if (time < 3) return { label: 'Expert', bg: '#c6f6d5', color: '#22543d' };
            if (time < 5) return { label: 'Advanced', bg: '#bfdbfe', color: '#1e40af' };
            if (time < 10) return { label: 'Intermediate', bg: '#fde68a', color: '#78350f' };
            if (time < 20) return { label: 'Beginner', bg: '#e5e7eb', color: '#374151' };
            return { label: 'Learning', bg: '#fee2e2', color: '#991b1b' };
        }

        function getTimeColor(time) {
            if (time < 3) return '#10b981';
            if (time < 10) return '#f59e0b';
            return '#ef4444';
        }

        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        function clearTimeHistory() {
            if (confirm('Are you sure you want to clear all time history? This cannot be undone.')) {
                gameState.sessionStats.history = [];
                updateTimeHistory();
                showFeedback('Time history cleared', 'info');
            }
        }

        function exportTimeHistory() {
            const history = gameState.sessionStats.history;
            if (history.length === 0) {
                showFeedback('No history to export', 'info');
                return;
            }
            
            // Create CSV content
            let csv = 'Number,Challenge,User Answer,Correct Answer,Result,Time (s),Speed Class,Mode,Timestamp\n';
            
            history.forEach(entry => {
                const speedClass = getSpeedClass(entry.time);
                csv += `${entry.number},"${entry.challenge}","${entry.userAnswer}","${entry.correctAnswer}",${entry.isCorrect ? 'Correct' : 'Incorrect'},${entry.time.toFixed(2)},${speedClass.label},${entry.mode},${entry.timestamp}\n`;
            });
            
            // Download CSV
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `memory_trainer_history_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showFeedback('History exported successfully!', 'correct');
        }
    </script>
</body>
</html>
